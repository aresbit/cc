# WiFi接收机的构造与解释

如何设计接收器？

统一的简洁思想在于定义接收机的：

- 目标函数
- 优化方程

即定义有关“性能”函数和优化该函数的算法。

该方法提供了一个统一的框架来导出 AGC、时钟恢复、载波恢复和均衡算法等系列系统组件。

软件接收器设计只需要微积分、矩阵代数和傅里叶变换的知识。

所以评估通信系统组件行为的两种方法也是：研究性能函数和进行实验检验算法。无需对组成信号的细节（例如高斯噪声）做出假设就可以导出各个组件中体现的算法。

概率的使用仅限于天真的想法，例如数字集合的平均值的概念，而不需要随机过程的机制。

采用“软件定义”方法反映了现代接收器设计的趋势，其中越来越多的系统是在可重新配置的软件中设计和构建的。

通信的主要思想在于教授调制的变换，以及教授同步和均衡的递归技术。

所谓递归即是递归，不动点，代数方程，　循环不变，归纳法是也。

处理设计细节的方法论在于如何提出和回答假设问题。

如果系统中有噪音怎么办？

如果调制频率不完全符合规定怎么办？

如果接收到的数字有错误怎么办？

如果数据速率不够高怎么办？

如果传输通道中存在失真、反射或回声怎么办？

如果接收器移动怎么办？

回归本源

## 收音机如何设计？

目标函数：重现声音。![image](https://github.com/aresbit/cc/assets/33110495/9de56298-643f-46d9-adc9-e60472c80961)


如何表示声音？　万物皆数，　符号编码即可。

第一性原理：　频域越宽， 时域越短， 符号越多数据率越高。

AM调制，发射机设计在于乘以一个高频正弦波　在频域做加法频谱搬移。

在接收器处，信号可以通过乘以另一个高频正弦波（然后进行低通滤波）返回到其原始频率（解调）。

理想定时同步，同频同相的信号，　但是实际接受符号必然要解决定时同步和载波同步问题。

调制正弦波和解调正弦波必须具有相同的频率和相同的相位，以便将信号返回到其原始形式。正如不可能精确对齐任何两个时钟一样，也不可能生成两个频率和相位完全相同的独立正弦波。因此，最终需要某种“载波同步”，一种对齐这些振荡器的方法。

基带设计大体如下，涉及：![image](https://github.com/aresbit/cc/assets/33110495/58699ab0-9f7f-43df-89aa-4920cab4f45b)

采样部分构成中射频子系统。

采样定理： 

只要采样速度快于信号最高频率两倍，就不会丢失任何信息。

零中频架构和超外差接收机：

如果发射机调制到非常高的频率，则采样得足够快可能会花费太多。目前，通常的做法是在接收器的模拟部分中执行一些频率转换和一些带外信号减少。有时，模拟部分可能会将接收到的信号一直转换回基带。其他时候，模拟部分转换为某个中频，然后数字部分完成转换。这种（看似多余）方法的优点是模拟部分可以制作得很粗糙，因此也很便宜。数字处理完成工作，同时补偿（廉价）模拟电路中的不准确性和缺陷。因此，接收机的数字信号处理部分可能需要校正接收机的模拟部分中出现的信号损伤以及由信道引起的损伤。

信号处理DSP设计：

[image](https://github.com/aresbit/cc/assets/33110495/9b71f154-af64-4efd-bfb9-272b8dabdd4d)

由此介绍了数据的数字传输，并讨论了如何将信息位编码为波形，跨空间发送到接收器，然后解码回位。由于没有通用时钟，定时问题变得很重要，数字接收器设计中一些最复杂的问题涉及接收信号的同步。该系统可以被视为由三部分组成：

tx ch rx

电磁波是 模拟信号 服从傅里叶， 

带宽BW

tx 上变频 载波调制 复用 FDM OFDM OFDMA
![image](https://github.com/aresbit/cc/assets/33110495/07df8186-3947-4230-81cc-14ecb87d6acd)

带通滤波器　频域乘积　＝　时域卷积

TDM，　CDMA　空分复用　各种复用。多址，　OFDMA，　MIMO，　智能天线（天线阵列信号处理）

采样　采数　ADC　接收机

由于廉价且功能强大的数字处理器的激增，接收器通常包含本质上是专用计算机的芯片SOC。在此类接收器中，传统上由分立元件（例如模拟振荡器和滤波器）处理的许多功能可以通过数字方式处理。当然，这需要将模拟接收信号转化为计算机可以处理的数字信息（一系列数字）。这种模数转换 (A/D) 称为采样。

由于奈奎斯特重构原理，在接收器中，采样速度必须至少是被采样的模拟信号中存在的最高频率的两倍，以避免混叠。

高频的DAC直接对接收信号进行采样是困难的，　一般是考虑下变频

零中频架构下，下变频（以及随后的低通滤波）在模拟电路中完成，并且在低通滤波器的输出处获取样本。采样率可以是最高频率的两倍。由此构成了所谓中射频子系统。简单架构的代价是需要昂贵的模拟器件和DPD等子系统来补偿模拟PA的失真。

由于传输介质（例如空气、电话线、海洋）是模拟的，因此比特被转换为模拟信号。然后这个模拟信号就可以像以前一样被传输。因此，每个“数字”通信系统的核心都是“模拟”系统。发送器的输出、传输介质和接收器的前端必然是模拟的。

数字通信的噪声不会累计，　误码率低，编码纠错，但是比模拟需要更多　带宽，需要解决同步问题。

SINC函数来了，

![image](https://github.com/aresbit/cc/assets/33110495/1f4bf453-bb4a-4d0e-a9f3-7e674bea22f6)


移位的脉冲形状乘以数据序列的每个成员，然后相加。如果信道是完美的（无失真且无噪声），则传输的信号将原封不动地到达接收器。通过在正确的时间进行采样，可以从接收到的波形中恢复原始数据。这就是定时同步在数字系统中如此重要的原因之一。在错误的时间采样可能会导致数据混乱。

时域中矩形脉冲形状的傅里叶变换是频域中的sinc函数。类似地，时域中sinc函数的傅里叶变换是频域中的矩形脉冲

因此，sinc 的频谱是带限的，因此它适用于需要带限消息的情况，例如 FDM。

实际的脉冲形状在少量带外频率快速下降以允许合理截断（时域）的脉冲响应之间进行折衷。例如平方根升余弦形状。

接收端对传输脉冲信号定时采样,以判断传输的数字0或1。

如果脉冲顶部比较尖锐,那么小的定时偏移就会导致采样值发生较大变化。

这也是数字通信中优化脉冲形状的一个重要考虑因素。

使脉冲顶部平坦可以通过滤波来实现,因此传输脉冲通常会经过带通滤波器以控制其形状。这可以提高对定时偏差的容忍度,降低误码率。

同步：![image](https://github.com/aresbit/cc/assets/33110495/242a9cf2-ae49-4ad7-b40c-38772730b32b)


在数字接收器中，在适当的时刻对接收信号进行采样非常重要。而且，这些时刻事先是不知道的；相反，它们必须根据信号本身来确定。这就是时钟恢复的问题。典型的策略是对每个脉冲进行多次采样，然后使用某种标准来选择最佳的一个、估计最佳时间或插入适当的值。还必须有一种方法来处理当发送器处定义符号时钟的振荡器与接收器处定义符号时钟的振荡器不同时的情况。类似地，载波同步是从接收信号中恢复载波（频率和相位）的过程（比如锁相环技术）。数字接收器中的任务与模拟接收器中的任务相同

软件接收器设计中采用的观点是，许多同步任务可以非常简单地表述为优化问题。因此，同步任务的许多标准解决方案可以被视为这些优化问题的解决方案。

当一个问题无法解决时候我们通常先将其转化为凸优化问题来解决问题。

- 时钟同步

时钟（或定时）恢复问题可以表述为找到定时偏移τ以使接收信号的能量最大化的问题。通过梯度技术解决这个优化问题产生了定时恢复的标准算法。所谓梯度，人工智能或者递归是也。

- 帧同步

在许多应用程序中，消息以称为数据包的簇形式出现，每个数据包都有一个包含重要信息的标头（位于每个数据块内某个商定的位置）。识别报头出现在接收信号中何处的过程称为帧同步，通常使用相关技术来实现。随机过程的相关或者功率谱密度如何来实现帧同步？

实现数字通信系统中的帧同步,主要思路如下:

1. 在数据帧头部插入已知的同步码,这些码通常构成一个随机过程。
2. 在接收端,计算接收信号的自相关函数或功率谱密度。
3. 由于同步码的自相关函数或谱密度具有特定的特征,可以通过在自相关函数或谱密度上检测这些特定特征,来定位同步码的位置。
4. 一旦检测到同步码,就可以根据同步码的已知结构,确定整个帧的起始位置和定时关系。
5. 常用的同步码结构有PRBS序列、Barker序列等,它们都具有良好的自相关特性,便于通过相关运算检测。

其中自相关函数R(τ)和功率谱密度S(f)之间存在 Fourier变换的关系,具体公式为:

自相关函数到功率谱密度的Fourier变换:

S(f) = ∫R(τ)e^(-j2πfτ)dτ S(f) = ∫R(τ)e^(-j2πfτ)dτ

功率谱密度到自相关函数的Fourier逆变换:

R(τ) = ∫S(f)e^(j2πfτ)df R(τ) = ∫S(f)e^(j2πfτ)df

其中:

R(τ):信号的自相关函数

S(f):信号的功率谱密度

τ:时滞参数

f:频率

j:虚数单位



- 载波同步

1. 载波相位同步的问题可以表述为:找到一个相位偏移θ,以最小化调制接收信号的某个特定函数。
2. 通过梯度技术求解这个优化问题,会导出锁相环,这是载波恢复的标准方法。通过调整一个电压控制振荡器的相位,使其与输入信号的相位同步。它使用一个相位检测器来生成一个误差信号,该误差信号经过环路滤波和放大,控制振荡器的相位。当相位锁定时,误差信号最小,此时振荡器的相位就是最佳估计的载波相位。

设接收信号为:

r(t) = Acos(ωc*t + θ)

其中θ为未知的相位偏移量。

构建代价函数:

J(θ) = E[f(r(t),θ)]

其中f(r(t),θ)是一个关于相位偏差的函数,比如f可以取误差的平方。

目标是找到θ以最小化代价函数J(θ)。

使用梯度下降法,每次更新θ如下:

θ(k+1) = θ(k) - μ*∂J/∂θ

其中μ是步长,∂J/∂θ是代价函数对θ的梯度。

展开则可得:

θ(k+1) = θ(k) - μ*E[∂f/∂θ]

定义误差信号e(t)=f(r(t),θ),则有:

θ(k+1) = θ(k) - μ*E[de/dθ]

这就是一个典型的锁相环迭代形式。e(t)就是环路的相位误差检测。

通过不断迭代更新θ以最小化误差,θ会逐步接近最佳估计,达到相位锁定。

所以,锁相环实质上是相位估计的一个梯度下降优化过程,这推导出了其数学本质。

ISI，码间干扰与均衡技术。

在大多数实际无线系统（以及许多有线系统）中，传输信道会导致传输符号的多个副本在不同时间到达接收器。这种符号间干扰可能会导致数据混乱。通道还可以将不同的频率衰减不同的量。因此，频率选择性会使数据难以辨认。

解决这两个问题的方法是在接收器中构建一个滤波器，尝试消除通道的影响。该滤波器称为均衡器。

均衡器设计问题可以表述为一个简单的优化问题，即在仅给定接收到的数据（可能还有训练序列）的情况下，找到一组滤波器参数以最小化误差。

由此可见所谓自适应信号处理乃是凸优化应用也。

## 信息论

克劳德·香农提出了一种以比特为单位测量信息的方法，以及以比特率（每秒传输的比特数）来衡量信道容量的方法。

信道容量取决于信道的带宽以及信号功率与噪声功率的比。

C = B log2(1 + S/N)

其中:

C - 信道容量(单位:比特每秒)

B - 信道带宽(单位:赫兹)

S/N - 信号功率与噪声功率之比,即信噪比

要传输的数据常常是冗余的，并且冗余浪费了信道的容量。其次，噪声可能在符号之间分布不均匀。

1. 给定信道带宽B时,调制方式、信道编码等只能通过提高信噪比来增加容量。线性分组编码。

   - LDPC码和极化码

     1. 它们都是经过精心设计的前向错误校正码,可以提供很高的编码增益。
     2. 编码增益可以翻译为信噪比的改善,有效提高了信道的信噪比。
     3. LDPC码采用稀疏校验矩阵,迭代译码可以实现接近香农限的性能。
     4. 极化码通过信道分裂和综合实现极化,也可以逼近香农限。

   - QAM通过调制两个正交载波实现了每个码元传输多个比特，增加了最小欧氏距离,更能抵抗高斯噪声的影响,提高噪声容限。

     QAM以在相位和振幅上都进行调制,从而实现每个码元传输多个比特。例如16QAM就可以每次传输4个比特。

     1. 比特(Bit):数字讯号的基本单位,0或1。
     2. 码元(Symbol):调制的基本单位,每个码元映射一个调制符号,传输多个比特。如16QAM每个码元传输4个比特。
     3. 符号(Signal):调制后代表码元的模拟波形。16QAM有16种调制符号。



如何解决冗余问题呢？

信源编码。信源编码主要进行数据压缩和减少冗余

霍夫曼码，它是一种变长码，将短位串分配给频繁符号，将较长位串分配给不频繁符号。

LZW编码:无损数据压缩。

格雷码是一种线性分组码,主要用于信道编码，在数字调制系统中,将输入的比特序列映射到不同的调制符号上时,会使用格雷码对比特序列进行重新编码。这样相邻符号只差一位,可以减少调制误码。格雷码用于映射、同步、定位等应用

通信系统之类的框图可能显得复杂且令人生畏。有这么多不同的块和这么多陌生的名称和缩写！幸运的是，所有的块都可以由六个简单的元素构建：![image](https://github.com/aresbit/cc/assets/33110495/7e4bc5cb-d7c2-4e83-a039-8d5b73eeb047)


自动增益控制滤波器:根据信号输入电平,自动调整滤波器增益,用于校正信号电平。

1. 平方器对输入信号取平方,会引入谐波频率分量。
2. 量化器将信号量化为有限数量的输出级,相当于一种非线性转换,也会引入新的谐波。
3. 这两种静态非线性操作都属于谐波失真,会污染信号频谱。

混频器，

- 混频器的核心部件是混频器管或乘法器。
- 滤波器则通过组合电感电容和设计网络来实现。

通信系统的元件有输入和输出；该元件本身对其输入信号进行操作以创建其输出信号。形成输入和输出的信号是表示某些感兴趣的变量（例如电压、电流、功率、气压、温度等）对时间的依赖性的函数。

元件的动作可以通过其在“时域”中运行的方式来描述，即元件如何将输入波形时刻改变为输出波形。描述元件行为的另一种方法是通过它在“频域”中的运行方式

自适应是学习的一种原始形式。电信系统中的自适应元件找到未知参数的近似值，试图补偿不断变化的条件或提高性能。参数估计问题中的常见策略是猜测一个值，评估猜测的好坏，并随着时间的推移完善猜测。运气好的话，这些猜测会收敛到对未知值的有用估计

## 自适应信号处理

自适应是人工智能的一种体现， 常见实现也以递归形式处理， 比如梯度下降， 比如递归解决开平方，比如牛顿迭代。

AGC： 

由 a 参数化的自适应子系统将输入更改为输出。质量评估机制监控输出（和其他相关信号）并尝试确定 a 是否应该增加或减少。穿过系统的箭头表示随后相应地调整 a 值。

在自动增益控制中，“自适应子系统”乘以常数 a。质量评估机制衡量AGC输出的功率是否太大或太小，并相应地调整a。![image](https://github.com/aresbit/cc/assets/33110495/76f68258-2748-4b8e-b694-aa8bbc27ea7a)


在锁相环中，“自适应子系统”包含一个具有未知相移 a 的正弦曲线。质量评估机制调整 a 以最大化正弦曲线及其输入的乘积的滤波版本。

在定时恢复设置中，“自适应子系统”是由 a 给出的分数延迟。一种用于评估质量的机制监视输出的功率，并调整α以最大化该功率。

1. 插值用于重新构建连续时的采样信号,需要恢复正确的时钟或定时。
2. 最大化信号能量等价于找到最佳采样定时,使噪声最小,两者目标一致。
3. 梯度技术可以求解最大化信号能量的最优定时偏移τ。
4. 自适应子系统使用控制环路调整分数定时偏移α,也是为最大化输出功率。
5. 因此它们都是基于优化采样定时,使噪声最小、信号能量最大化。
6. 插值、最大化信号能量、自适应控制环路都是实现这一目标的不同手段。
7. 它们本质上都是时钟同步技术

在均衡器中，“自适应子系统”是由一组 a 参数化的线性滤波器。质量评估机制监控系统输出与目标集的偏差，并相应地进行调整。





